#!/usr/bin/env ruby

$LOAD_PATH.unshift("lib")

require 'dllt'


EM.kqueue = true if EM.kqueue? # file watching requires kqueue on OSX

EventMachine::run do
  DLLT::ClientServer.start('10.0.65.208:9001', '9002')
  DLLT::Guard.start('dictionary/dictionary.txt')
  DLLT::Unison.start('9000')

  quit = Proc.new {
    puts "quitting EM"
    DLLT::ClientServer.unregister
    EM.stop
  }

  Signal.trap "INT", quit
  Signal.trap "TERM", quit
end
